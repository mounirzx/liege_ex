<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DataTables Example</title>
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"> -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.1/css/dataTables.dataTables.css"/>
</head>
<body>
  <div class="container mt-3">
    <div class="mb-3">
      <label for="selectOption" class="form-label">Select Data Option:</label>
      <select class="form-select" id="selectOption">
        <option value="1">Sous Parcelles</option>
        <option value="2">Points</option>
        <option value="3">Arbres</option>
      </select>
    </div>
    <table id="example" class="table table-striped table-bordered" style="width:100%;">
      <thead>
        <tr>
          <th>ID</th>
          <th>num_Point</th>
          <th>Serie</th>
          <th>Sousparcelle</th>
          <th>Code Wilaya</th>
          <th>Commune</th>
          <th>Total Diametre</th>
          <th>Diametre(moyen)</th>
          <th>Nombre des Arbres</th>
          <th>Total Hauteur</th>
          <th>Height (Moyenne)</th>
          
          <th>Total Age</th>
          <th> Age(Moyen)</th>
          <th>surface_terriere</th>
          <!-- <th>Total Height demasclage</th>
          <th>Average Height demasclage</th>
          <th>Age</th> -->
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="13" class="text-center loader" style="display: none;">Loading...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/2.0.1/js/dataTables.js"></script>
  <script>
    $(document).ready(function() {
      var table;
  
      function initializeDataTable() {
        // Show loader
        $('.loader').show();
  
        // Destroy the existing DataTable if it exists
        if ($.fn.DataTable.isDataTable('#example')) {
          $('#example').DataTable().destroy();
        }
  
        // Initialize DataTable
        table = $('#example').DataTable({
          "processing": true,
          "serverSide": false, // Set serverSide to false
          "ajax": {
            "url": "../php/data.php",
            "type": "POST",
            "data": function(d) {
              d.option = $('#selectOption').val();
            },
            "dataSrc": function(json) {
              return json.data;
            }
          },
          "order": [], // Remove default sorting
          "columns": [
            { "data": "id" },
            { "data": "num_Point" },
            { "data": "serie" },
            { "data": "Sousparcelle" },
            { "data": "code_wilaya" },
            { "data": "commune" },
            { "data": "total_diametre" },
            { "data": "average_diametre" },
            { "data": "nombre_tree" },
            { "data": "total_hauteur_total" },
            { "data": "average_hauteur_total" },
            { "data": "total_age" },
            { "data": "average_age" },
            { "data": "surface_terriere" } 
          ],
          "paging": true, // Enable pagination
          "pageLength": 10, // Set the number of rows per page
          "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]] // Customize length menu
        });
      }
  
      // Initialize DataTable on document ready
      initializeDataTable();
  
      // Event listener for dropdown change
      $('#selectOption').change(function() {
        // Show loader
        $('.loader').show();
        
        // Reinitialize DataTable with new option
        initializeDataTable();
      });
  
      // Show loader when AJAX request starts
      $(document).ajaxStart(function() {
        $('.loader').show();
      });
  
      // Hide loader when AJAX request completes
      $(document).ajaxStop(function() {
        $('.loader').hide();
      });
    });
  </script>
  
</body>
</html>
